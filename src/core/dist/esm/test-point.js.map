{"version":3,"file":"test-point.js","sourceRoot":"","sources":["../../src/test-point.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,KAAK,EAAE,MAAM,YAAY,CAAA;AAClC,OAAO,EAAE,GAAG,EAAE,MAAM,UAAU,CAAA;AAc9B;;GAEG;AACH,MAAM,OAAO,SAAS;IACpB,EAAE,CAAmB;IACrB,IAAI,CAAQ;IACZ,OAAO,CAAQ;IACf,KAAK,CAAwB;IAC7B,GAAG,CAAQ;IAEX,YACE,EAAW,EACX,OAAe,EACf,KAA8B;QAE9B,KAAK,GAAG,KAAK,IAAI,EAAE,CAAA;QACnB,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS,CAAA;QAChC,OAAO,GAAG,OAAO;aACd,IAAI,EAAE;aACN,OAAO,CAAC,SAAS,EAAE,GAAG,CAAC;aACvB,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;QACvB,IAAI,CAAC,GAAG,GAAG,EAAE,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,CAAA;QACjC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAA;QAClB,IAAI,CAAC,IAAI,GAAG,OAAO,CAAA;QACnB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAA;IACjD,CAAC;CACF;AAED,MAAM,SAAS,GAAG,CAChB,WAAmB,EACnB,KAA2B,EACnB,EAAE;IACV,IAAI,OAAO,GAAG,WAAW,CAAC,CAAC,CAAC,MAAM,WAAW,EAAE,CAAC,CAAC,CAAC,EAAE,CAAA;IAEpD,IAAI,KAAK,CAAC,IAAI,EAAE,CAAC;QACf,OAAO,IAAI,SAAS,CAAA;QACpB,IAAI,OAAO,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YACnC,OAAO,IAAI,GAAG,GAAG,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;QAClC,CAAC;IACH,CAAC;SAAM,IAAI,KAAK,CAAC,IAAI,EAAE,CAAC;QACtB,OAAO,IAAI,SAAS,CAAA;QACpB,IAAI,OAAO,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YACnC,OAAO,IAAI,GAAG,GAAG,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;QAClC,CAAC;IACH,CAAC;SAAM,IAAI,KAAK,CAAC,IAAI,EAAE,CAAC;QACtB,OAAO,IAAI,UAAU,GAAG,KAAK,CAAC,IAAI,GAAG,IAAI,CAAA;IAC3C,CAAC;IAED,2CAA2C;IAE3C,MAAM,QAAQ,GAAG,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAA;IAC5D,OAAO,IAAI,QAAQ,GAAG,IAAI,CAAA;IAE1B,OAAO,OAAO,CAAA;AAChB,CAAC,CAAA","sourcesContent":["import { diags } from './diags.js'\r\nimport { esc } from './esc.js'\r\nimport { Extra } from './index.js'\r\n\r\n/**\r\n * Very simple result object, just indicating pass/fail status,\r\n * message, and the {@link @tapjs/core!index.Extra} object provided to the\r\n * assertion method.\r\n */\r\nexport interface Result {\r\n  ok: boolean\r\n  message: string\r\n  extra: Extra\r\n}\r\n\r\n/**\r\n * Object representing a single test point `ok` / `not ok` line\r\n */\r\nexport class TestPoint {\r\n  ok: 'ok ' | 'not ok '\r\n  name: string\r\n  message: string\r\n  extra: { [key: string]: any }\r\n  res: Result\r\n\r\n  constructor(\r\n    ok: boolean,\r\n    message: string,\r\n    extra?: { [key: string]: any },\r\n  ) {\r\n    extra = extra || {}\r\n    this.ok = ok ? 'ok ' : 'not ok '\r\n    message = message\r\n      .trim()\r\n      .replace(/[\\n\\r]/g, ' ')\r\n      .replace(/\\t/g, '  ')\r\n    this.res = { ok, message, extra }\r\n    this.extra = extra\r\n    this.name = message\r\n    this.message = tpMessage(esc(this.name), extra)\r\n  }\r\n}\r\n\r\nconst tpMessage = (\r\n  description: string,\r\n  extra: { [k: string]: any },\r\n): string => {\r\n  let message = description ? ` - ${description}` : ''\r\n\r\n  if (extra.skip) {\r\n    message += ' # SKIP'\r\n    if (typeof extra.skip === 'string') {\r\n      message += ' ' + esc(extra.skip)\r\n    }\r\n  } else if (extra.todo) {\r\n    message += ' # TODO'\r\n    if (typeof extra.todo === 'string') {\r\n      message += ' ' + esc(extra.todo)\r\n    }\r\n  } else if (extra.time) {\r\n    message += ' # time=' + extra.time + 'ms'\r\n  }\r\n\r\n  // TODO: add # time if duration_ms in extra\r\n\r\n  const diagYaml = extra.diagnostic ? '\\n' + diags(extra) : ''\r\n  message += diagYaml + '\\n'\r\n\r\n  return message\r\n}\r\n"]}