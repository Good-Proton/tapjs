{"version":3,"file":"set-plugin-core-link.js","sourceRoot":"","sources":["../../src/set-plugin-core-link.ts"],"names":[],"mappings":"AAAA;;GAEG;AAEH,OAAO,EAAE,YAAY,EAAE,WAAW,EAAE,MAAM,IAAI,CAAA;AAC9C,OAAO,EAAE,UAAU,EAAE,MAAM,QAAQ,CAAA;AACnC,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,MAAM,CAAA;AACvC,OAAO,EAAE,UAAU,EAAE,MAAM,QAAQ,CAAA;AAEnC,MAAM,QAAQ,GAAG,CAAC,UAAkB,EAAE,EAAE;IACtC,IAAI,CAAC;QACH,OAAO,YAAY,CAAC,UAAU,CAAC,CAAA;IACjC,CAAC;IAAC,MAAM,CAAC,CAAA,CAAC;AACZ,CAAC,CAAA;AAED,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAC/B,SAAiB,EACjB,IAAY,EACZ,EAAE;IACF,MAAM,QAAQ,GAAG,OAAO,CAAC,SAAS,EAAE,cAAc,CAAC,CAAA;IACnD,MAAM,UAAU,GAAG,OAAO,CAAC,QAAQ,EAAE,aAAa,CAAC,CAAA;IACnD,MAAM,MAAM,GAAG,QAAQ,CAAC,UAAU,CAAC,CAAA;IACnC,IAAI,MAAM,KAAK,IAAI,EAAE,CAAC;QACpB,UAAU,CAAC,UAAU,CAAC,CAAA;QACtB,UAAU,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,CAAA;QAC/B,WAAW,CAAC,IAAI,EAAE,UAAU,CAAC,CAAA;IAC/B,CAAC;AACH,CAAC,CAAA","sourcesContent":["/**\r\n * create a symlink from our @tapjs/core into the plugin dir's node_modules\r\n */\r\n\r\nimport { readlinkSync, symlinkSync } from 'fs'\r\nimport { mkdirpSync } from 'mkdirp'\r\nimport { dirname, resolve } from 'path'\r\nimport { rimrafSync } from 'rimraf'\r\n\r\nconst readLink = (pluginCore: string) => {\r\n  try {\r\n    return readlinkSync(pluginCore)\r\n  } catch {}\r\n}\r\n\r\nexport const setPluginCoreLink = (\r\n  pluginDir: string,\r\n  core: string,\r\n) => {\r\n  const pluginNM = resolve(pluginDir, 'node_modules')\r\n  const pluginCore = resolve(pluginNM, '@tapjs/core')\r\n  const target = readLink(pluginCore)\r\n  if (target !== core) {\r\n    rimrafSync(pluginCore)\r\n    mkdirpSync(dirname(pluginCore))\r\n    symlinkSync(core, pluginCore)\r\n  }\r\n}\r\n"]}